@import 'variable';

#{$biz-css-prefix} {
  @each $bgType in $backgroundTypes {
    &bg--#{$bgType} {
      background: var(--color-#{$bgType});
    }
  }
  &safe-area {
    height: env(safe-area-inset-bottom);
    height: constant(safe-area-inset-bottom);
  }

  &page {
    height: 100vh;
    margin: 0 auto;
    box-sizing: border-box;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;

    &-page--headless {
      padding-top: var(--page-content-padding-tb);
    }
    &-page--footless {
      padding-bottom: var(--page-content-padding-tb);
    }

    &-header {
      margin-bottom: var(--page-section-gap);
      padding: var(--page-padding-tb) var(--page-header-padding-lr) var(--page-block-padding-tb);

      &--no-bottom-padding {
        padding-bottom: 0;
      }

      &--dividing {
        border-bottom: var(--line-1) solid var(--page-header-divider-color);
      }
      &--fixed {
        position: fixed;
        width: 100vw;
        left: 0;
        top: 0;
        z-index: var(--elevation-4);
      }
    }

    &-header,
    &-footer {
      box-sizing: border-box;

      &-inner {
        box-sizing: border-box;
        margin-left: auto;
        margin-right: auto;
      }
    }

    &-footer {
      margin-top: var(--page-section-gap);
      padding: var(--page-block-padding-tb) var(--page-header-padding-lr) var(--page-padding-tb);
      padding-bottom: calc(var(--page-block-padding-tb) - constant(safe-area-inset-bottom));
      padding-bottom: calc(var(--page-block-padding-tb) - env(safe-area-inset-bottom));

      &--no-top-padding {
        padding-top: 0;
      }

      &--fixed {
        position: sticky;
        left: 0;
        bottom: 0;
        width: 100vw;
        z-index: var(--elevation-4);
      }
      &--dividing {
        border-top: var(--line-1) solid var(--color-line1-3);
      }
    }

    &-content {
      &-inner {
        display: grid;
        grid-template-rows: auto;
        gap: var(--page-section-gap);
        box-sizing: border-box;
      }
      &--no-padding {
        padding: 0;
      }
    }
  }

  &section {
    box-sizing: border-box;
    padding-left: var(--page-padding-lr);
    padding-right: var(--page-padding-lr);
    width: 100%;

    &-inner {
      width: 100%;
      margin-left: auto;
      margin-right: auto;
    }

    &-block-wrapper {
      display: grid;
      gap: var(--page-block-gap);
    }

    &-title,
    &-title > #{$biz-css-prefix}p {
      color: var(--page-section-title-font-color);
    }

    &-title > #{$biz-css-prefix}p > #{$biz-css-prefix}p-text {
      font-weight: bold;
    }

    &-extra #{$biz-css-prefix}p,
    &-extra {
      color: var(--page-section-extra-font-color);
    }
  }

  &page-content:first-child #{$biz-css-prefix}section:first-child {
    padding-top: var(--page-padding-tb);
  }
  &page-content:last-child #{$biz-css-prefix}section:last-child {
    padding-bottom: var(--page-padding-tb);
  }

  &block {
    border-radius: var(--page-block-corner);
    overflow: hidden;

    @each $size in $sizes {
      &--#{$size} {
        grid-gap: var(--page-block-#{$size}-gap);
      }
    }

    &-head {
      padding: var(--page-block-padding-tb) var(--page-block-padding-lr) 0;
    }

    &--headless {
      padding: var(--page-block-padding-tb) var(--page-block-padding-lr);
    }

    &--no-padding {
      padding: 0;
    }

    &-title #{$biz-css-prefix}p,
    &-title {
      color: var(--page-block-title-font-color);
    }

    &-title > #{$biz-css-prefix}p > #{$biz-css-prefix}p-text {
      font-weight: bold;
    }

    &-extra #{$biz-css-prefix}p,
    &-extra {
      color: var(--page-block-extra-font-color);
    }

    &--divided {
      border-bottom: var(--line-1) solid var(--page-header-divider-color);
      padding-bottom: var(--page-block-padding-tb);
    }

    &-content {
      padding-left: var(--page-block-padding-lr);
      padding-right: var(--page-block-padding-lr);
      padding-bottom: var(--page-block-padding-tb);

      &--no-padding {
        padding: 0;
      }
    }

    &--no-padding {
      padding: 0;
    }

    &--bordered {
      border: var(--line-1) solid var(--color-line1-3);
    }
  }

  &cell-row-gap {
    grid-row-gap: var(--page-grid-gap);
  }

  &cell-col-gap {
    grid-column-gap: var(--page-grid-gap);
  }

  &cell {
    box-sizing: border-box;

    &-align {
      &--left {
        align-items: flex-start;
      }
      &--center {
        align-items: center;
      }
      &--right {
        align-items: flex-end;
      }

      //note: 对 Cell 下的 P, align 属性直接继承
      &--left #{$biz-css-prefix}p {
        justify-content: flex-start;
      }
      &--center #{$biz-css-prefix}p {
        justify-content: center;
      }
      &--right #{$biz-css-prefix}p {
        justify-content: flex-end;
      }
      &--space-evenly #{$biz-css-prefix}p {
        justify-content: space-evenly;
      }
      &--space-between #{$biz-css-prefix}p {
        justify-content: space-between;
      }
      &--space-around #{$biz-css-prefix}p {
        justify-content: space-around;
      }

      &--middle,
      &--center,
      &--left {
        @each $size in $sizes {
          #{$biz-css-prefix}p-spacing--#{$size} {
            & > *,
            & > text,
            & > view {
              margin-right: var(--page-p-#{$size}-spacing);
            }
          }
        }
      }

      &--space-evenly,
      &--space-around,
      &--space-between,
      &--stretch {
        #{$biz-css-prefix}p-spacing {
          & > *,
          & > text,
          & > view {
            margin-left: 0;
            margin-right: 0;
          }
        }
      }

      &--left,
      &--center,
      &--middle {
        #{$biz-css-prefix}p-spacing {
          & > *,
          & > text,
          & > view {
            &:last-child {
              margin-right: 0;
            }
          }
        }
      }

      &--right {
        @each $size in $sizes {
          #{$biz-css-prefix}p-spacing--#{$size} {
            & > *,
            & > text,
            & > view {
              margin-left: var(--page-p-#{$size}-spacing);
            }
          }
        }

        #{$biz-css-prefix}p-spacing {
          & > *,
          & > text,
          & > view {
            margin-right: 0;

            &:first-child {
              margin-left: 0;
            }
          }
        }
      }

      &-stretch {
        & > *,
        & > text,
        & > view {
          margin-left: 0;
          margin-right: 0;
        }
      }
    }
  }

  &grid {
    display: grid;
    grid-gap: var(--page-grid-gap);

    &-align--left {
      justify-items: start;
    }
    &-align--center {
      justify-items: center;
    }
    &-align--right {
      justify-items: end;
    }
    &-align--stretch {
      justify-items: stretch;
    }

    &-valign--top {
      align-items: start;
      align-content: start;
    }
    &-valign--center,
    &-valign--middle {
      align-items: center;
      align-content: center;
    }
    &-valign--bottom {
      align-items: end;
      align-content: end;
    }
    &-valign--baseline {
      align-items: baseline;
    }
    &-valign--stretch {
      align-items: stretch;
    }
  }

  // flex 模式的 row & col
  &row-flex {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    flex: 1 1 auto;
    gap: var(--page-grid-gap);
  }
  &col-flex {
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    gap: var(--page-grid-gap);
  }

  //============= paragraph ====
  &p {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    color: var(--page-p-font-color);

    // 段落下的纯文本
    &-text {
      //font-size: var(--p-body-1-font-size);
      //font-weight: var(--p-body-1-font-weight);
      //line-height: var(--p-body-1-line-height);
    }

    @each $type in $fontTypes {
      &--#{$type} {
        font-size: var(--p-#{$type}-font-size);
        font-weight: var(--p-#{$type}-font-weight);
        line-height: var(--p-#{$type}-line-height);
      }
    }

    &-margin > * {
      margin-top: var(--page-p-el-margin);
      margin-bottom: var(--page-p-el-margin);
    }

    // notice: 对于已经认定的纯文本节点，不加上下间距（依赖行高处理）
    &-margin > span,
    &-margin > .rax-text,
    &-margin > .rax-text-v2,
    &-margin > .h5-span,
    &-margin > text {
      margin-top: 0;
      margin-bottom: 0;
    }

    @each $size in $sizes {
      &-spacing--#{$size} {
        & > * {
          margin-right: var(--page-p-#{$size}-spacing);
        }
        &#{$biz-css-prefix}p-spacing--middle,
        &#{$biz-css-prefix}p-spacing--center,
        &#{$biz-css-prefix}p-spacing--left {
          & > * {
            margin-right: var(--page-p-#{$size}-spacing);
          }
        }
        &#{$biz-css-prefix}p-spacing--right {
          & > * {
            margin-left: var(--page-p-#{$size}-spacing);
          }
        }
      }
    }

    &-spacing {
      & > *,
      & > text,
      & > view {
        &:first-child {
          margin-left: 0;
        }
        &:last-child {
          margin-right: 0;
        }
      }

      &--left,
      &--center,
      &--middle {
        & > *,
        & > text,
        & > view {
          &:last-child {
            margin-right: 0;
          }
        }
      }

      &--right {
        & > *,
        & > text,
        & > view {
          margin-right: 0;

          &:first-child {
            margin-left: 0;
          }
        }
      }

      &--space-between,
      &--space-around,
      &--space-evenly {
        & > *,
        & > text,
        & > view {
          margin-left: 0;
          margin-right: 0;
        }
      }
    }

    &-valign--top {
      align-items: flex-start;
      vertical-align: top;
    }

    &-valign--stretch {
      align-items: stretch;
      vertical-align: middle;
    }

    &-valign--center,
    &-valign--middle {
      align-items: center;
      vertical-align: middle;
    }

    &-valign--bottom {
      align-items: flex-end;
      vertical-align: bottom;
    }

    &-valign--baseline {
      align-items: baseline;
      vertical-align: baseline;
    }
  }

  // notice: 为了处理 cell 中的 align，  p 的 align 模式，优先级提升
  &page #{$biz-css-prefix}p-align {
    &--right {
      text-align: right;
      justify-content: flex-end;
    }

    &--left {
      text-align: left;
      justify-content: flex-start;
    }

    &--center {
      text-align: center;
      justify-content: center;
    }

    &--space-between {
      justify-content: space-between;
    }

    &--space-evenly {
      justify-content: space-evenly;
    }

    &--space-around {
      justify-content: space-around;
    }
  }
}

// 移除页面边距处理
#{$biz-css-prefix}page--no-padding {
  #{$biz-css-prefix}page-header,
  #{$biz-css-prefix}section,
  #{$biz-css-prefix}page-footer {
    padding-left: 0;
    padding-right: 0;
  }
  #{$biz-css-prefix}page-header {
    padding-top: 0;
  }
  #{$biz-css-prefix}page-footer {
    padding-bottom: 0;
  }

  #{$biz-css-prefix}page-content:first-child #{$biz-css-prefix}section:first-child {
    padding-top: 0;
  }

  #{$biz-css-prefix}page-content:last-child #{$biz-css-prefix}section:last-child {
    padding-bottom: 0;
  }
}

@each $colNum in $columnNumEnum {
  #{$biz-css-prefix}page--col-#{$colNum} {
    #{$biz-css-prefix}section-block-wrapper,
    #{$biz-css-prefix}section-inner {
      grid-template-columns: repeat($colNum, 1fr);
    }

    @for $i from ($colNum + 1) through $maxNumberOfColumns {
      #{$biz-css-prefix}block--span-#{$i} {
        grid-column: span $colNum;
      }
    }

    @for $i from 1 through $colNum {
      #{$biz-css-prefix}block--span-#{$i} {
        grid-column: span $i;
      }
    }
  }
}

:root {
  --p-h1-font-size: var(--p-display-3-font-size);
  --p-h1-font-weight: var(--p-display-3-font-weight);
  --p-h1-line-height: var(--p-display-3-line-height);
  --p-h1-indent-size: var(--p-display-3-indent-size);

  --p-h2-font-size: var(--p-display-2-font-size);
  --p-h2-font-weight: var(--p-display-2-font-weight);
  --p-h2-line-height: var(--p-display-2-line-height);
  --p-h2-indent-size: var(--p-display-2-indent-size);

  --p-h3-font-size: var(--p-display-1-font-size);
  --p-h3-font-weight: var(--p-display-1-font-weight);
  --p-h3-line-height: var(--p-display-1-line-height);
  --p-h3-indent-size: var(--p-display-1-indent-size);

  --p-h4-font-size: var(--p-headline-font-size);
  --p-h4-font-weight: var(--p-headline-font-weight);
  --p-h4-line-height: var(--p-headline-line-height);
  --p-h4-indent-size: var(--p-headline-indent-size);

  --p-h5-font-size: var(--p-title-font-size);
  --p-h5-font-weight: var(--p-title-font-weight);
  --p-h5-line-height: var(--p-title-line-height);
  --p-h5-indent-size: var(--p-title-indent-size);

  --p-h6-font-size: var(--p-subhead-font-size);
  --p-h6-font-weight: var(--p-subhead-font-weight);
  --p-h6-line-height: var(--p-subhead-line-height);
  --p-h6-indent-size: var(--p-subhead-indent-size);

  --p-body1-font-size: var(--p-body-2-font-size);
  --p-body1-font-weight: var(--p-body-2-font-weight);
  --p-body1-line-height: var(--p-body-2-line-height);
  --p-body1-indent-size: var(--p-body-2-indent-size);

  --p-body2-font-size: var(--p-body-1-font-size);
  --p-body2-font-weight: var(--p-body-1-font-weight);
  --p-body2-line-height: var(--p-body-1-line-height);
  --p-body2-indent-size: var(--p-body-1-indent-size);
}
// 字体样式
#{$biz-css-prefix}text {
  @each $type in $fontTypes {
    &--#{$type} {
      font-size: var(--p-#{$type}-font-size);
      font-weight: var(--p-#{$type}-font-weight);
      line-height: var(--p-#{$type}-line-height);
      color: var(--page-#{$type}-font-color);

      &-indented {
        text-indent: var(--p-#{$type}-indent-size);
      }
    }
  }

  &--code {
    display: inline-block;
    border: var(--line-1) solid var(--page-text-code-border-color);
    border-radius: var(--page-text-code-corner);
    padding: 0 var(--s-1);
    background-color: var(--page-text-code-background-color);
    color: var(--page-text-code-color);
    margin: 0 0.2em;
  }

  &--strong {
    font-weight: bold;
  }

  &--underline {
    text-decoration: underline;
  }

  &--delete {
    text-decoration: line-through;
  }

  &--mark {
    color: var(--page-text-mark-color);
    background-color: var(--page-text-mark-background-color);
  }
}
